<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/static/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link rel="stylesheet" href="/static/layui/css/layui.css">
    <link rel="stylesheet" href="/static/css/plugins/sweetalert/sweetalert.css">
    <link rel="stylesheet" href="/static/css/baguetteBox.min.css">
    <link rel="stylesheet" href="/static/css/gallery-clean.css">
    <style>
        .jq22-demo {
            text-align: center;
            margin-top: 30px;
        }

        .jq22-demo a {
            padding-left: 20px;
            padding-right: 20px;
        }

        .tz-gallery .thumbnail {
            padding: 0;
            margin-bottom: 30px;
            border: 1px solid #ccc;
        }

        .thumbnail a > img, .thumbnail > img {
            margin-right: auto;
            margin-left: auto;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
<div class="htmleaf-container">
    <div class=" gallery-container">
        <div class="tz-gallery">
            <div class="row" style="margin-bottom: 20px">
                <div class="col-md-12">
                    <form role="search" class="navbar-form-custom form-inline" method="get"
                          action="{% url 'picture:image_list' %}">
                        <div class="form-group">
                            <input type="text" placeholder="可通过标签和标题搜索" class="form-control" name="q"
                                   id="top-search" style="width:350px" value="{{ q }}">
                            <input type="submit" class="btn btn-primary" value="搜索">
                        </div>
                    </form>
                </div>
            </div>

            <div class="row">
                {% for item in img_list.object_list %}
                    <div class="col-sm-6 col-md-3" id="{{ item.id }}">
                        <div class="thumbnail">
                            <a class="lightbox" href="/static/{{ item.md5_name }}">
                                <img src="/static/{{ item.md5_name }}" alt="Park">
                            </a>
                            <div class="caption">
                                <ul class="list-group">
                                    <li class="list-group-item tag{{ item.id }}"> 标签：{{ item.tags }}</li>

                                    <li class="list-group-item"> 名称：{{ item.filename }}</li>
                                    <li class="{{ item.id }} layui-hide"><input type="text" value="{{ item.tags }}"
                                                                                class="form-control">
                                        <button class="btn btn-default " style="margin-top:10px">保存</button>
                                    </li>
                                </ul>
                                <button type="button" class="btn btn-danger delete" file="{{ item.id }}">删除</button>
                                <button type="button" class="btn btn-primary edit" file="{{ item.id }}">编辑标签</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

        </div>
        <div id="pagenatior" style="text-align: center;">
            <div class="layui-box layui-laypage layui-laypage-default" id="layui-laypage-1">
                {% if img_list.has_previous %}
                    <a href="?{{ img_list.previous_page_number.querystring }}"
                       class="layui-laypage-prev">上一页</a>
                {% else %}
                    <a href="javascript:;" class="layui-laypage-prev layui-disabled">上一页</a>
                {% endif %}
                {% for page in img_list.pages %}
                    {% if page %}
                        {% if  page == img_list.number %}
                            <span class="layui-laypage-curr"><em
                                    class="layui-laypage-em"></em><em>{{ page }}</em></span>
                        {% else %}
                            <a href="?{{ page.querystring }}">{{ page }}</a>
                        {% endif%}
                    {% else %}
                        <span>....</span>
                    {% endif %}
                {% endfor %}
                {% if img_list.has_next %}
                    <a href="?{{ img_list.next_page_number.querystring }}"
                       class="layui-laypage-next">下一页</a>
                {% else %}
                    <a href="javascript:;" class="layui-laypage-next layui-disabled">下一页</a>
                {% endif %}
            </div>
        </div>
    </div>

</div>
<script src="/static/js/jquery.min.js?v=2.1.4"></script>
<script type="text/javascript" src="/static/js/baguetteBox.min.js"></script>
<script src="/static/js/plugins/sweetalert/sweetalert.min.js"></script>
<script>
    $(function () {
        $('.delete').click(function () {
            var id = $(this).attr("file");
            swal({
                title: "您确定要删除这条信息吗",
                text: "删除后将无法恢复，请谨慎操作！",
                type: "warning",
                showCancelButton: true,
                cancelButtonText: '取消',
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "删除",
                closeOnConfirm: false
            }, function () {
                $.post("{% url 'picture:delete_img' %}", {"id": id}, function (data) {
                    if (data["code"] = 200) {
                        swal(data["msg"], "您已经永久删除了这条信息。", "success");
                        $('#' + id).remove()
                    } else {
                        swal("删除失败", data["msg"], "error");
                    }
                })
            });


        });
        $(".edit").click(function () {
            var id = $(this).attr("file");
            $("." + id).toggleClass('layui-hide');
            var dom = $("." + id).find('button')
            dom.click(function () {
                swal({
                    title: "您确定要修改这条信息吗",
                    type: "warning",
                    showCancelButton: true,
                    cancelButtonText: '取消',
                    confirmButtonColor: "#DD6B55",

                    closeOnConfirm: false
                }, function () {
                    var tag=$("." + id).find('input').val();
                    $.post("{% url 'picture:edit_tag' %}", {"id": id,"tag":tag}, function (data) {
                        if (data["code"] = 200) {
                            swal(data["msg"], "您已经修改了这条信息。", "success");
                            $(".tag"+id).text("标签："+tag)
                            $("." + id).toggleClass('layui-hide');
                        } else {
                            swal("删除失败", data["msg"], "error");
                        }
                    })
                });
            })
        })
    })
</script>
<script type="text/javascript">
    baguetteBox.run('.tz-gallery');
</script>
</body>
</html>